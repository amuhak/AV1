<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><script>async function uploadFile(){let e;console.log("Starting uploadFile function");const o=document.getElementById("fileInput").files[0];if(!o)return console.log("No file selected"),void alert("Please select a file to upload.");console.log(`File selected: ${o.name}, size: ${o.size} bytes`);let t=document.getElementById("status"),n=document.createElement("b");n.textContent="Uploading...",t.replaceWith(n);const a=94371840;let s=Math.ceil(o.size/a);console.log(`File will be split into ${s} chunks of 94371840 bytes each`);const l=await calculateHash(o);console.log(`Calculated file hash: ${l}`);await Promise.all(Array.from({length:s},((e,t)=>(async e=>{const t=e*a,n=Math.min(o.size,t+a),r=o.slice(t,n);console.log(`Uploading chunk ${e}/${s}, size: ${r.size} bytes`);const c=new FormData;c.append("Hash",l),c.append("FileName",o.name),c.append("Chunk",r),c.append("Index",e),c.append("TotalChunks",s);try{const o=await fetch("/upload-chunk",{method:"POST",body:c});console.log(`Chunk ${e+1} upload response status: ${o.status}`)}catch(o){console.error(`Error uploading chunk ${e}:`,o)}})(t)))),console.log("All chunks uploaded successfully"),n.textContent="Combining...",console.log("Starting combine process"),e=new FormData,e.append("FileName",o.name),e.append("NoOfChunks",s),e.append("Hash",l);try{const o=await fetch("/combine",{method:"POST",body:e});console.log(`Combine response status: ${o.status}`)}catch(e){console.error("Error during combine process:",e)}n.textContent="Processing on remote server...",console.log("Starting remote processing"),e=new FormData,e.append("Hash",l),e.append("FileName",o.name);try{await fetch("/process",{method:"POST",body:e}),console.log("Remote processing request send")}catch(e){console.log(e),console.error("Error during remote processing:",e)}let r,c=!1;for(;!c;){try{const e=await fetch(`/status/${l}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const o=await e.json();!1!==o.done?(c=!0,r=o.done,console.log(`Conversion completed with ${r} parts`)):console.log("Conversion still in progress...")}catch(e){return console.error("Error checking status:",e),void alert("An error occurred while processing the file. Please try again.")}c||await new Promise((e=>setTimeout(e,1e3)))}console.log("Conversion process completed"),n.textContent="Downloading...",console.log("Starting download process");try{const e=async e=>{console.log(`Downloading chunk ${e+1}/${s}`);const o=await fetch(`/downloads/${l}/${e}`);if(!o.ok)throw new Error(`Failed to download part ${e}`);return await o.blob()},o=await Promise.all(Array.from({length:s},((o,t)=>e(t))));console.log("All parts downloaded successfully");const t=new Blob(o,{type:"application/octet-stream"});console.log(`Combined blob size: ${t.size} bytes`);const a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`${l}_av1.mp4`,r.textContent="Download Combined File",r.className="download-button",n.replaceWith(r),console.log("Download button added to document"),r.onclick=()=>{setTimeout((()=>{URL.revokeObjectURL(a),console.log("Object URL revoked")}),100)}}catch(e){console.error("Error downloading and combining file:",e),alert("An error occurred while preparing your download. Please try again.")}}async function calculateHash(e){const o=await e.arrayBuffer(),t=await crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(t)).map((e=>e.toString(16).padStart(2,"0"))).join("")}</script><title>AV1 Converter</title><style>:root{--bg-color:#f0f0f0;--text-color:#333;--container-bg:white;--input-border:#ddd;--button-bg:#4CAF50;--button-hover:#45a049}@media (prefers-color-scheme:dark){:root{--bg-color:#1a1a1a;--text-color:#f0f0f0;--container-bg:#2a2a2a;--input-border:#444;--button-bg:#45a049;--button-hover:#4CAF50}}body{font-family:Arial,sans-serif;max-width:600px;margin:0 auto;padding:20px;background-color:var(--bg-color);color:var(--text-color);transition:background-color .3s,color .3s}h1{text-align:center}.container{background-color:var(--container-bg);padding:20px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1)}#fileInput{display:block;width:100%;padding:10px;margin-bottom:20px;border:1px solid var(--input-border);border-radius:4px;background-color:var(--container-bg);color:var(--text-color);box-sizing:border-box}#status{display:block;width:100%;padding:10px;background-color:var(--button-bg);color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:16px;transition:background-color .3s}#status:hover{background-color:var(--button-hover)}#status:disabled{background-color:#ccc;cursor:not-allowed}</style><script defer="defer" src="index.bundle.js"></script></head><body><div class="container"><h1>AV1 Video Converter</h1><p>Select a video file to convert to AV1 format:</p><input type="file" id="fileInput" accept="video/*"/> <button onclick="uploadFile()" id="status">Convert to AV1</button></div><div id="bottom"><p><strong>Note:</strong> this is a demonstration of chunked file upload and download. The file is uploaded in chunks, processed on the server, and then downloaded in chunks. The server converts the video to AV1 format. (ffmpeg is used to convert the video to AV1 format). In general, this should decrease the size of the video file while maintaining quality. It works better with larger files (for example, over 50MB). It's been noticed that small (less than 2mb) highly compressed files may be larger after conversion. This is due to the overhead of the AV1 codec. It's best to test with a variety of files to see the results.</p></div></body></html>