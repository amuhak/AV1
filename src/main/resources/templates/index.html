<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><script>async function uploadFile(){let e;const t=document.getElementById("fileInput").files[0];if(!t)return void alert("Please select a file to upload.");let a=document.getElementById("status"),n=document.createElement("b");n.textContent="Uploading...",a.replaceWith(n);const o=94371840;let r=Math.ceil(t.size/o);const l=await calculateHash(t);await Promise.all(Array.from({length:r},((e,a)=>(async e=>{const a=e*o,n=Math.min(t.size,a+o),i=t.slice(a,n),c=new FormData;c.append("Hash",l),c.append("FileName",t.name),c.append("Chunk",i),c.append("Index",e),c.append("TotalChunks",r),await fetch("/upload-chunk",{method:"POST",body:c})})(a)))),n.textContent="Combining...",e=new FormData,e.append("FileName",t.name),e.append("NoOfChunks",r),e.append("Hash",l),await fetch("/combine",{method:"POST",body:e}),n.textContent="Processing on remote server...",e=new FormData,e.append("Hash",l),e.append("FileName",t.name);let i=await fetch("/process",{method:"POST",body:e});i=await i.json(),r=i.noOfParts,n.textContent="Downloading...";try{const e=async e=>{const t=await fetch(`/downloads/${l}/${e}`);if(!t.ok)throw new Error(`Failed to download part ${e}`);return await t.blob()},t=await Promise.all(Array.from({length:r},((t,a)=>e(a)))),a=new Blob(t,{type:"application/octet-stream"}),o=URL.createObjectURL(a),i=document.createElement("a");i.href=o,i.download=`${l}_av1.mp4`,i.textContent="Download Combined File",i.className="download-button",n.replaceWith(i),i.onclick=()=>{setTimeout((()=>URL.revokeObjectURL(o)),100)}}catch(e){console.error("Error downloading and combining file:",e),alert("An error occurred while preparing your download. Please try again.")}}async function calculateHash(e){const t=await e.arrayBuffer(),a=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(a)).map((e=>e.toString(16).padStart(2,"0"))).join("")}</script><title>AV1 Converter</title><style>:root{--bg-color:#f0f0f0;--text-color:#333;--container-bg:white;--input-border:#ddd;--button-bg:#4CAF50;--button-hover:#45a049}@media (prefers-color-scheme:dark){:root{--bg-color:#1a1a1a;--text-color:#f0f0f0;--container-bg:#2a2a2a;--input-border:#444;--button-bg:#45a049;--button-hover:#4CAF50}}body{font-family:Arial,sans-serif;max-width:600px;margin:0 auto;padding:20px;background-color:var(--bg-color);color:var(--text-color);transition:background-color .3s,color .3s}h1{text-align:center}.container{background-color:var(--container-bg);padding:20px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,.1)}#fileInput{display:block;width:100%;padding:10px;margin-bottom:20px;border:1px solid var(--input-border);border-radius:4px;background-color:var(--container-bg);color:var(--text-color);box-sizing:border-box}#status{display:block;width:100%;padding:10px;background-color:var(--button-bg);color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:16px;transition:background-color .3s}#status:hover{background-color:var(--button-hover)}#status:disabled{background-color:#ccc;cursor:not-allowed}</style><script defer="defer" src="index.bundle.js"></script></head><body><div class="container"><h1>AV1 Video Converter</h1><p>Select a video file to convert to AV1 format:</p><input type="file" id="fileInput" accept="video/*"/> <button onclick="uploadFile()" id="status">Convert to AV1</button></div><div id="bottom"><p><strong>Note:</strong> This is a demonstration of chunked file upload and download. The file is uploaded in chunks, processed on the server, and then downloaded in chunks. The server converts the video to AV1 format. (ffmpeg is used to convert the video to AV1 format). In general, this should decrease the size of the video file while maintaining quality. It works better with larger files (e.g., over 50MB). It has been noticed that small (less than 2mb) highly compressed files my be larger after conversion. This is due to the overhead of the AV1 codec. It is best to test with a variety of files to see the results.</p></div></body></html>